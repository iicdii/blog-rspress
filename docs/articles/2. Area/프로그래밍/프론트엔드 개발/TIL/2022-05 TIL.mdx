---
tags: null
created: 2022-05-04T00:00:00.000Z
published: true
title: 2022-05 TIL
---

import ArticleInfo from '../../../../../../components/ArticleInfo'

# 2022-05 TIL

<ArticleInfo />

**2022-05-04**
# `return await` ê°€ ì½”ë“œë¥¼ ëŠë¦¬ê²Œ ë§Œë“œëŠ” ì´ìœ 

**ðŸ‘Ž Bad**
```js
async function foo() {
    return await bar();
}
```
> Using `return await` inside an `async function` keeps the current function in the call stack until the Promise that is being awaited has resolved, at the cost of an extra microtask before resolving the outer Promise. `return await` can also be used in a try/catch statement to catch errors from another function that returns a Promise.
> You can avoid the extra microtask by not awaiting the return value, with the trade off of the function no longer being a part of the stack trace if an error is thrown asynchronously from the Promise being returned. This can make debugging more difficult. - [Eslint no-return-await ë£° ì„¤ëª… ë¬¸ì„œ](https://eslint.org/docs/rules/no-return-await)

`async function` ì•ˆì—ì„œ `return await` ë¥¼ í•˜ë©´ ì½œìŠ¤íƒ ì•ˆì˜ í•¨ìˆ˜ì—ì„œ Promiseê°€ resolved ë  ë•Œ ê¹Œì§€ ëŒ€ê¸°í•˜ë¯€ë¡œ **ì¶”ê°€ì ì¸ microtask ë¹„ìš©**ì´ ë“ ë‹¤ê³  í•©ë‹ˆë‹¤.
**ë¦¬í€˜ìŠ¤íŠ¸ ìš”ì²­ ìˆ«ìžì— ë¹„ë¡€í•´ì„œ ì´ ë¹„ìš©ì´ ì¦ê°€í•˜ë¯€ë¡œ, ë§Œì•½ íŠ¸ëž˜í”½ì´ ë§Žì´ ëª°ë¦¬ëŠ” ê²½ìš° ë¬¸ì œê°€ ì»¤ì§ˆ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.**
ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ ì•„ëž˜ì²˜ëŸ¼ return í•˜ë©´ ë©ë‹ˆë‹¤.

**ðŸ‘ Good**
```js
async function foo() {
  return bar();
}
```

ê·¸ëŸ¼ `return await` ëŠ” ì–¸ì œ ì“¸ê¹Œìš”? ì•„ëž˜ì™€ ê°™ì€ ìƒí™©(try/catch)ì— ì“°ë©´ ë©ë‹ˆë‹¤.

```js
// Correct usage of `return await`
async function fn() {
  try {
    return await work();
  } catch (err) {
    return handleWorkError(error);
  }
}
```
ìœ„ ì˜ˆì œì—ì„œ ë§Œì•½ `await work();` ì˜ `await` ë¥¼ ì œê±°í•˜ë©´ ì—ëŸ¬ê°€ ë‚˜ë„ catch ë¬¸ ì•ˆì˜ ì½”ë“œê°€ ì ˆëŒ€ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ë”°ë¼ì„œ ì´ ê²½ìš°ì—ëŠ” `return await` ë¥¼ ì¨ì¤˜ì•¼ catchë¬¸ì—ì„œ ì—ëŸ¬ë¥¼ ìž¡ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

# React Queryì—ì„œ ë„¤íŠ¸ì›Œí¬ ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ Mocking í•˜ëŠ” ë°©ë²•
**ê²°ë¡ : MSW ì¨ì„œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ëª¨í‚¹í•˜ì„¸ìš”**

> Use mock service worker by @ApiMocking

MSWì— ëŒ€í•´ ê°„ë‹¨ížˆ ì„¤ëª…í•˜ë©´ ë¸Œë¼ìš°ì €ì˜ **ì„œë¹„ìŠ¤ ì›Œì»¤ì—ì„œ requestë¥¼ interceptí•´ì„œ ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ ëª¨í‚¹**í•˜ëŠ” ì‹ìœ¼ë¡œ ë™ìž‘í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ìž…ë‹ˆë‹¤.

> Mock Service Worker is an API mocking library for browser and Node. It provides seamless mocking by interception of actual requests on the network level using Service Worker API. This makes your application unaware of any mocking being at place.

- Browserë¿ë§Œ ì•„ë‹ˆë¼ Nodeì—ì„œë„ ë™ìž‘í•©ë‹ˆë‹¤.
- RESTì™€ GraphQLì„ ì§€ì›í•©ë‹ˆë‹¤. (`import { graphql } from 'msw'`)
- fetch ëª¨í‚¹ì„ ë©ˆì¶°ì£¼ì„¸ìš” ë¼ëŠ” ë¸”ë¡œê·¸ì—ì„œë„ MSWë¥¼ ëŒ€ì•ˆìœ¼ë¡œ ì œì‹œí•˜ê³  ìžˆìŠµë‹ˆë‹¤.
- Cypress ì—ì„œë„ ìž˜ ë™ìž‘í•©ë‹ˆë‹¤.

ì°¸ê³ ë¡œ, axiosë¥¼ ì“°ëŠ”ì§€, fetchë¥¼ ì“°ëŠ”ì§€, graphql-requestë¥¼ ì“°ëŠ”ì§€ì™€ ìƒê´€ì—†ì´ ìš”ì²­ì„ interceptí•´ì„œ ë‚´ê°€ ì›í•˜ëŠ” responseë¥¼ ë°˜í™˜í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

> The beauty of MSW is that it's agnostic of your request-issuing setup. All you have to do is to declare a query name that you wish to intercept and describe how to mock its response. - [discussions/789](https://github.com/mswjs/msw/discussions/879#discussioncomment-1224337)

ì•„ëž˜ëŠ” ì˜ˆì‹œìž…ë‹ˆë‹¤. ì¿¼ë¦¬ì˜ name (opretaion name ì•„ë‹˜)ì„ ì¸í„°ì…‰íŠ¸í•´ì„œ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ëŠ” ë¡œì§ìž…ë‹ˆë‹¤.
```js
import { graphql } from 'msw'

const handlers = [
  graphql.query('getBrandsModels', (req, res, ctx) => {
    return res(
      ctx.data({
        brands: [
          {
            id: 1,
            brand: 'Lego',
            models: [
              {
                id: 2,
                model: 'Porsche',
              },
            ],
          },
        ],
      })
    )
  }),
]
```

graphql.link ë¥¼ ì´ìš©í•´ì„œ íŠ¹ì • GraphQL Endpoint ê¸°ë°˜ìœ¼ë¡œ ìš”ì²­ì„ intercept í•  ìˆ˜ë„ ìžˆìŠµë‹ˆë‹¤.
```js
import { graphql } from 'msw'

const myService = graphql.link(process.env.NEXT_PUBLIC_API_GRAPHQL_URL)

const handlers = [
  myService.query('getBrandsModels', (req, res, ctx) => {
    // The mocked response as described above.
  }),
]
```